{{- $main := resources.Get "css/main.css" | postCSS -}}

{{- if hugo.IsDevelopment -}}
  {{- /* ensure main will rebuild on every update only in development */ -}}
  {{- $main = $main | resources.ExecuteAsTemplate (printf "css/main.dev.%v.css" now.UnixMilli) . -}}
{{- end -}}

{{- $css := slice $main -}}

{{- if hugo.IsProduction -}}
  {{- with $css | resources.Concat "css/bundle.css" | minify | fingerprint -}}
    <link rel="stylesheet" href="{{ .RelPermalink }}" />
  {{- end -}}
{{- else -}}
  {{- range $css -}}
    <link rel="stylesheet" href="{{ .RelPermalink }}" />
  {{- end -}}
{{- end -}}
